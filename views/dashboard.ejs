<html>
    <%- include('./partials/document/head') %>
    <body>
        <% if (user) { %>

        <main class="main__dashboard">
            <% if (locals.errors){ %>
                <div class="error__msg">
                    <%errors.forEach(error => { %>
                        <p> <%= error.msg %></p>
                    <% }) %>
                </div>
            <% } %>
            <div class="create__modal">
                <form action="/dashboard/create-folder" method="POST">
                    <div>
                        <label for="folder">Folder Name</label>
                        <br>
                        <input type="text" name="folderName" id="folder" class="create__folder">
                        <input type="text" name="userId" value="<%= user.id %>" readonly class="hidden">
                    </div>
                    <div class="modal__buttons">
                        <button type="submit">Create</button>
                        <button class="close__cfmodal">Close</button> 
                    </div>
                </form>
            </div>
            <div class="upload__modal">
                <form action="/dashboard/upload/null" method="POST" enctype="multipart/form-data" class="upload__form">
                    <div>
                        <label for="file" class="file__upload"></label>
                        <input type="file" name="file" id="file" class="file__drop" required>
                        <label for="folder__name"></label>
                        <select name="folderId" id="folder__name" class="folder__select">
                            <option value="">None</option>
                            <%user.folders.forEach(folder => { %>
                                <option value="<%= folder.id %>,<%= folder.name %>">
                                    <%= folder.name %>
                                </option>
                            <% }) %>
                        </select>
                    </div>
                    <div class="modal__buttons">
                        <p class="file__name">File: None</p>
                        <button type="submit">Upload</button>
                        <button class="close__umodal">Close</button>
                    </div>
                </form>
            </div>
            <div class="file__modal">
                <button class="close__fmodal">Close</button>
                <label for="efile__name" class="efile__label">File Name:</label>
                <input type="text" class="efile__name" id="efile__name">
                <p class="file__size"></p>

                <div class="modal__buttons">
                    <form action="" method="POST" action="" class="download__file">
                        <button class="emodal__button">
                            Download
                        </button>
                    </form>
                    <form action="" method="POST" action="" class="delete__file">
                        <button class="emodal__button">
                            Delete
                        </button>
                    </form>
                    <form action="" method="POST" action="" class="update__file">
                        <input type="text" readonly class="hidden absolute h__input" name="newName">
                        <button class="emodal__button">
                            Save
                        </button>
                    </form>
                </div>
            </div>
                <section class="file__container">
                    <h1 class="file__header">Your Folders: </h1>
                    <%user.folders.forEach(folder => { %>
                        <button class="file__button"><h2><%= folder.name %>:</h2></button>
                        <p class="path" hidden><%= folder.name %>/</p>
                        <ul>
                            <li class="file__item">
                                <% if (folder.files.length !== 0){ %>
                                    <%folder.files.forEach(file => { %>
                                        <p href="<%= file.url %>">
                                            <%= file.name %>
                                        </p>
                                        <p class="path to_<%= file.id %>" hidden>
                                            <%= folder.name %>/<%= file.name %>
                                        </p>
                                    <% }) %>
                                <% } else { %>
                                    <p class="file__item__empty">Folder is Empty</p>
                                <% } %>
                            </li>
                        </ul>
                    <% }) %>
                </section>
                <section class="content__container">
                    <div class="content__container__nav">
                        <button class="upload__button">Upload File</button>
                        <input type="text" class="search__bar">
                        <button class="create__button">Create Button</button>
                    </div>
                            
                    <div class="content__content">
                        <% if(user.file.length !== 0) { %>
                            <div class="file__block">
                                <p class="file__content">Name</p>
                                <p class="file__content">Created At</p>
                                <p class="file__content">Updated At</p>
                                <p class="file__content">Size</p>
                            </div>
                            <% user.folders.forEach(folder => { %>
                                <% folder.files.forEach(file => { %>
                                    <button class="file__block">
                                        <p class="file__content"><%= file.name %></p>
                                        <p class="file__content cDate"><%= file.createdAt %></p>
                                        <p class="file__content uDate"><%= file.updatedAt %></p>
                                        <p class="file__content"><%= file.size %></p>
                                        <p class="hidden absolute"><%= file.id %></p>
                                        <p class="hidden absolute"><%= folder.name %></p>
                                    </button>
                                <% }) %>
                            <% }) %>
                            <% const unFiled = user.file.filter(file => !file.inFolder) %>
                            <% unFiled.forEach(file => { %>
                                <button class="file__block">
                                    <p class="file__content"><%= file.name %></p>
                                    <p class="file__content cDate"><%= file.createdAt %></p>
                                    <p class="file__content uDate"><%= file.updatedAt %></p>
                                    <p class="file__content"><%= file.size %></p>
                                    <p class="hidden absolute"><%= file.id %></p>
                                </button>
                            <% }) %>
                        <% } else { %>
                            <h1 class="file__empty">No Files Yet</h1>
                            <p class="hello"></p>
                        <% } %>
                    </div>
                </section>
        </main>
        <% } else { %>
            <h1>Please Log In</h1>
            <a href="/">Log in</a>
        <% } %>
    </body>
</html>